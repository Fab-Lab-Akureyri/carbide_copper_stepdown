<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Modify G-Code</title>
<script>
function modifyFile() {
    const fileInput = document.getElementById('fileInput');
    const file = fileInput.files[0];
    const button = document.getElementById('modifyButton');

    if (!file) {
        alert('Please select a file!');
        return;
    }

    const reader = new FileReader();
    reader.onload = function (e) {
        const lines = e.target.result.split('\n');
        
        let originalZDepth = null;
        let zDepthLineIndex = null;
        for (let i = 0; i < lines.length; i++) {
            const match = lines[i].match(/G01 F200 Z(-\d+\.\d+)/);
            if (match) {
                originalZDepth = parseFloat(match[1]);
                zDepthLineIndex = i;
                break;
            }
        }

        if (originalZDepth === null) {
            alert('Original Z depth not found.');
            return;
        }

        if (zDepthLineIndex === null) {
            alert('Z depth line not found.');
            return;
        }

        const g01StartIndex = lines.findIndex(line => /G01 F200 X\d+\.\d+ Y\d+\.\d+/.test(line));
        if (g01StartIndex === -1) {
            alert('G01 lines not found.');
            return;
        }

        let modifiedLines = lines.slice(0, zDepthLineIndex);
        
        [1 / 3, 2 / 3, 1].forEach(multiplier => {
            modifiedLines.push(`G01 F200 Z${(originalZDepth * multiplier).toFixed(3)}`);
            modifiedLines = modifiedLines.concat(lines.slice(g01StartIndex, zDepthLineIndex), lines.slice(zDepthLineIndex + 1));
        });

        const modifiedContent = modifiedLines.join('\n');
        const blob = new Blob([modifiedContent], {type: 'text/plain'});
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'modified_' + file.name;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        button.style.backgroundColor = '#4CAF50';
        button.style.color = 'white';
        button.style.padding = '14px 20px';
        button.style.borderRadius = '4px';
    };
    reader.readAsText(file);
}
</script>
</head>
<body>
<input type="file" id="fileInput">
<button id="modifyButton" onclick="modifyFile()" style="background-color: #555555; color: white; padding: 12px 20px; border: none; cursor: pointer; width: 100%; opacity: 0.9;">Modify G-Code</button>
</body>
</html>
